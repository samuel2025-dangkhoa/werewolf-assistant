<!doctype html>
<html lang="vi">
<head>
  <meta charset="utf-8" />
  <meta name="viewport"
        content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no, viewport-fit=cover">
  <title>Trá»£ Thá»§ Quáº£n TrÃ² Ma SÃ³i</title>
  <style>
    :root{
      --bg: #0f1222;
      --bg-elev: #171b33;
      --text: #eef2ff;
      --muted:#a5b4fc;
      --accent:#7c5cff;
      --accent-2:#22d3ee;
      --danger:#ef4444;
      --ok:#10b981;
      --card: #141832;
      --border:#283056;
      --shadow: 0 10px 30px rgba(0,0,0,.35);
      --radius: 16px;
      /* LÆ°á»›i pháº§n â€œThiáº¿t láº­p vai trÃ²â€ */
      --roles-cols: 1.2fr .6fr 120px auto;
    }

    *{ box-sizing:border-box }

    /* NgÄƒn má»i trÃ n ngang, giá»¯ kÃ­ch cá»¡ chá»¯ há»‡ */
    html, body{
      height:100%;
      max-width:100%;
      overflow-x:hidden;
      -webkit-text-size-adjust:100%;
      text-size-adjust:100%;
    }

    body{
      margin:0;
      font:16px/1.5 system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
      color:var(--text);
      background:
        radial-gradient(1400px 900px at 15% -10%, #2a3b77 0%, #18203f 58%),
        radial-gradient(1100px 700px at 110% 30%, rgba(124,92,255,.25), rgba(34,211,238,0) 70%),
        linear-gradient(180deg, #0e1430 0%, #0a0f22 100%);
    }

    /* ===== HEADER full-bleed, KHÃ”NG bo gÃ³c ===== */
    header{
      position: sticky;
      top: 0;
      z-index: 100;
      padding: 16px 20px;
      border-bottom: 1px solid rgba(255,255,255,.06);
      overflow: visible;
      isolation: isolate; /* Ä‘á»ƒ ::before/::after náº±m trÃªn ná»n nhÆ°ng dÆ°á»›i ná»™i dung */
    }

/* Hiá»ƒn thá»‹ Ä‘á»§ chá»¯ trÃªn cÃ¡c nÃºt Äiá»n tÃªn, XÃ¡o trá»™n, XÃ³a ngÆ°á»i chÆ¡i */
#autoFillNames,
#shuffleNames,
#removeEmptyNames {
  white-space: normal !important;   /* cho xuá»‘ng dÃ²ng náº¿u thiáº¿u chá»— */
  text-overflow: unset !important;  /* bá» dáº¥u "..." */
  overflow: visible !important;     /* hiá»ƒn thá»‹ Ä‘á»§ ná»™i dung */
  max-width: none !important;       /* khÃ´ng giá»›i háº¡n chiá»u ngang */
  min-width: 120px;                 /* tá»‘i thiá»ƒu 120px cho Ä‘á»§ chá»¯ */
  flex: 1;                          /* chia Ä‘á»u má»—i nÃºt náº¿u cÃ¹ng hÃ ng */
}

#playerSetupRow > .row {
  display: flex;
  justify-content: space-between; /* cÃ¡c nÃºt cÃ¡ch Ä‘á»u nhau */
  gap: 8px;                       /* khoáº£ng cÃ¡ch giá»¯a nÃºt */
}

    /* Táº¥m má» toÃ n bá» ngang */
    header::before{
      content:"";
      position:absolute;
      inset:0;                               /* theo chiá»u cao header */
      margin-left:  calc(50% - 50vw);
      margin-right: calc(50% - 50vw);
      background: linear-gradient(0deg, rgba(15,18,34,.20), rgba(15,18,34,.60));
      backdrop-filter: blur(8px);
      -webkit-backdrop-filter: blur(8px);
      z-index:-1;
      border-radius:0;
    }
    /* Hiá»‡u á»©ng sÃ¡ng */
    header::after{
      content:"";
      position:absolute;
      inset:0;
      margin-left:  calc(50% - 50vw);
      margin-right: calc(50% - 50vw);
      pointer-events:none;
      background:
        radial-gradient(900px 280px at 25% 40%, rgba(255,255,255,.10), rgba(255,255,255,0) 70%),
        radial-gradient(700px 240px at 70% 60%, rgba(255,255,255,.08), rgba(255,255,255,0) 70%);
      opacity:.9;
      z-index:-1;
      border-radius:0;
    }
    /* Náº¿u mÃ¡y há»— trá»£ viewport Ä‘á»™ng, váº«n Ä‘áº£m báº£o full-bleed mÃ  khÃ´ng sinh thanh trÆ°á»£t */
    @supports (width: 100dvw){
      header::before, header::after{ width:100dvw; left:50%; transform:translateX(-50%); margin:0; }
    }

    /* Ná»™i dung tiÃªu Ä‘á» */
    header .title{
      display:flex; flex-direction:column; align-items:center; gap:6px;
      max-width:1200px; margin:0 auto;
    }
    header .title .top-row{ display:flex; align-items:center; gap:10px; flex-wrap:nowrap }
    header .title h1{
      margin:0; font-weight:800; letter-spacing:.3px; white-space:nowrap;
      font-size:clamp(20px,5vw,34px); line-height:1.1;
    }
    .logo{ width:32px; height:32px }
    .logo img{ width:100%; height:100%; object-fit:cover; border-radius:10px }

    /* ===== Layout ===== */
    .container{ position:relative; z-index:1; max-width:1200px; margin:20px auto; padding:0 16px }
    .container::after{
      content:""; position:fixed; right:-6vw; top:240px; width:88vw; height:1200px;
      border-radius:28px;
      background: linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.02));
      box-shadow: 0 0 60px rgba(124,92,255,.18), 0 0 120px rgba(34,211,238,.12);
      opacity:.45; pointer-events:none; z-index:0;
    }

    .grid{ display:grid; gap:16px }
    @media (min-width:980px){ .grid{ grid-template-columns:1.2fr .8fr } }

    .card{
      background:linear-gradient(180deg, rgba(255,255,255,.02), rgba(255,255,255,.01));
      border:1px solid var(--border); border-radius:var(--radius); box-shadow:var(--shadow);
      padding:14px; position:relative; z-index:1; max-width:100%;
    }
    .card h2{ margin:6px 6px 14px; font-size:20px }

    label{ display:block; margin:10px 6px 6px; color:var(--muted); font-size:13px }
    input[type="number"], input[type="text"], select, textarea{
      width:100%; padding:12px; border-radius:12px; border:1px solid var(--border);
      background:#0c0f1f; color:var(--text); outline:none; transition:.2s border,.2s box-shadow
    }
    input:focus, textarea:focus{ border-color:var(--accent); box-shadow:0 0 0 4px rgba(124,92,255,.15) }
    /* Tá»± giÃ£n: bá» thanh cuá»™n bÃªn trong */
textarea{
  min-height:160px;
  resize:none;          /* khÃ´ng cáº§n kÃ©o tay ná»¯a */
  overflow:hidden;      /* áº©n scrollbar bÃªn trong */
}

    .row{ display:flex; gap:10px; align-items:center }
    .row.wrap{ flex-wrap:wrap }
    .grow{ flex:1 }

    .btn{
      padding:10px 14px; border:1px solid var(--border); color:var(--text); background:#11152b;
      border-radius:12px; cursor:pointer; transition:.15s transform,.2s background,.2s border-color
    }
    .btn:hover{ transform:translateY(-1px); background:#171c36 }
    .btn:active{ transform:translateY(0) }
    .btn.primary{ background:linear-gradient(135deg, var(--accent) 0%, #5f44ff 100%); border:none }
    .btn.ghost{ background:transparent }
    .btn.danger{ background:#2a0f12; border-color:#5e1a22; color:#ffb4b4 }
    .btn.ok{ background:#0d2a22; border-color:#13493b; color:#c7ffee }

    .hint{ font-size:12px; color:#c7cfff; opacity:.9 }
    .chip{ display:inline-flex; align-items:center; gap:8px; font-size:12px; padding:6px 10px; border-radius:999px; background:#0c0f1f; border:1px solid var(--border) }

    /* Danh sÃ¡ch tÃªn ngÆ°á»i chÆ¡i â€“ 2 cá»™t khÃ´ng trÃ n */
    .names{
      display:grid;
      grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
      gap:10px; width:100%;
    }

    /* TiÃªu Ä‘á» section */
    .section-title{ display:flex; flex-wrap:wrap; justify-content:space-between; align-items:center; gap:6px }
    .section-title h2{ margin:0 }

    /* Header khu vai trÃ² */
    .section-title.roles-head{
      display:grid; grid-template-columns: var(--roles-cols); align-items:end; gap:8px
    }
    .section-title.roles-head h2{ grid-column:1 / span 2; margin:0 }
    .section-title.roles-head .chip{ grid-column:3; justify-self:start }

    /* Báº£ng vai trÃ² (grid, khÃ´ng trÃ n) */
    .roles{
      display:grid; grid-template-columns: var(--roles-cols); gap:8px; align-items:center; width:100%;
    }
    .roles .header{ font-size:12px; color:var(--muted); opacity:.8; padding:0 6px }
    .roles .item{ display:contents }
    .roles input[type="number"]{ width:120px }

    /* Khu thÃªm vai trÃ² */
    #customRoleName{ flex:1 1 320px; min-width:200px }
    #customRoleCount{ width:90px; text-align:center }
    #customRoleActions{ width:100%; display:flex; justify-content:center; gap:10px; margin-top:8px }
    #customRoleActions .btn{ min-width:140px }

    .pill{ font-size:12px; opacity:.9; padding:4px 8px; border-radius:999px; border:1px dashed #334; display:inline-flex; gap:6px; align-items:center; width:max-content }

    /* Danh sÃ¡ch phÃ¢n vai â€“ fit mÃ n hÃ¬nh */
    .assignments table{ width:100%; border-collapse:collapse; table-layout:fixed }
    .assignments th,.assignments td{ border-bottom:1px solid #2a315a; padding:10px; text-align:left; }
    .assignments tr.revealed td.role{ filter:none }
    .assignments td.role.hidden{ filter:blur(8px); opacity:.7 }
    .assignments th, .assignments td{ overflow:hidden; text-overflow:ellipsis; white-space:nowrap }

    /* CÃ´ng cá»¥ */
    .tools{ display:grid; gap:10px; margin-top:12px; grid-template-columns:repeat(2,1fr) }
    .tools .btn.primary{ grid-column:1 / -1 }
    .tools .btn{ width:100%; text-align:center; white-space:normal; justify-content:center }
    @media (min-width:640px){ .tools{ grid-template-columns:repeat(3,1fr) } }
    @media (min-width:960px){ .tools{ grid-template-columns:repeat(4,1fr) } }

    .kbd{ font-family:ui-monospace,SFMono-Regular,Menlo,Consolas,"Liberation Mono",monospace; font-size:12px; background:#0b0e1d; border:1px solid var(--border); padding:2px 6px; border-radius:6px }

    .timer-big{ font-variant-numeric:tabular-nums; font-weight:800; font-size:clamp(36px,11vw,48px); letter-spacing:1px; text-align:center; margin:8px 0 12px }
    .timer-controls{ display:flex; gap:8px; flex-wrap:wrap; justify-content:center }

    .footer{ opacity:.6; text-align:center; font-size:12px; padding:12px }

    /* Print */
    @media print{
      header, .no-print{ display:none !important }
      body{ background:#fff; color:#000 }
      .card{ box-shadow:none; border:1px solid #ccc }
      .assignments td.role.hidden{ filter:none }
    }
    #rolesList{ display:contents }

    /* ===== Modal vai trÃ² ===== */
    .modal-backdrop{
      position:fixed; inset:0; background:rgba(0,0,0,.55);
      display:none; align-items:center; justify-content:center;
      z-index:9999; padding:16px;
    }
    .modal-backdrop.show{ display:flex }
    /* Bo viá»n toÃ n bá»™ modal vÃ  cáº¯t (clip) má»i hiá»‡u á»©ng má» bá»‹ trÃ n */
.modal{
  border-radius:12px;
  overflow:hidden;                 /* QUAN TRá»ŒNG: khÃ´ng cho dáº£i má» trÃ n ra */
}

/* Header modal: Ä‘Ã£ bo gÃ³c trÃªn, váº«n giá»¯ overflow Ä‘á»ƒ khÃ´ng bá»‹ leak */
.modal header{
  position:relative;
  overflow:hidden;
  border-radius:12px 12px 0 0;     /* bo 2 gÃ³c trÃªn */
}

/* Pháº§n ná»™i dung: bo 2 gÃ³c dÆ°á»›i Ä‘á»ƒ khá»›p vá»›i khung modal */
.modal .content{
  padding:16px;
  border-radius:0 0 12px 12px;     /* bo 2 gÃ³c dÆ°á»›i */
  overflow:hidden;                 /* phÃ²ng khi cÃ³ hiá»‡u á»©ng má» bÃªn trong */
}

/* Ná»n tá»‘i cá»§a pháº§n mÃ´ táº£ â€“ chá»‰ bo gÃ³c dÆ°á»›i (trÃªn Ä‘Ã£ do header Ä‘áº£m nhiá»‡m) */
#roleModalBody{
  background: rgba(8,12,28,.72);
  backdrop-filter: blur(2px);
  -webkit-backdrop-filter: blur(2px);
  border: 1px solid rgba(255,255,255,.06);
  border-radius: 0 0 12px 12px;    /* chá»‰ bo 2 gÃ³c dÆ°á»›i */
  padding: 14px 16px;
  color: var(--text);
  line-height: 1.8;
  white-space: pre-wrap; text-align: justify; text-wrap: pretty; hyphens: auto;
}

    .modal .close{ border:1px solid var(--border); background:#11152b; color:var(--text); border-radius:10px; padding:8px 12px; cursor:pointer }

    /* Label â€œSá»‘ ngÆ°á»i chÆ¡iâ€ khÃ´ng báº» dÃ²ng */
    label[for="playerCount"]{ white-space:nowrap }

    /* CÄƒn Ä‘á»u cá»™t mÃ´ táº£ */
    .roles .item div:nth-child(2){ text-align:justify; text-justify:inter-word }

    /* Co giÃ£n cho mÃ n nhá» â€“ xá»­ lÃ½ triá»‡t Ä‘á»ƒ viá»‡c bá»‹ â€œkhuyáº¿tâ€ bÃªn pháº£i */
    @media (max-width:420px){
      .container{ padding:0 10px }
      .card{ padding:12px; border-radius:14px }
      .section-title{ gap:4px }
      .chip{ padding:5px 8px; font-size:12px }
      .btn{ padding:8px 12px; font-size:14px }
      .btn.primary{ font-size:15px }
      input[type="number"], input[type="text"], select, textarea{ padding:10px; border-radius:10px; font-size:15px; max-width:100% }

      /* TÃªn ngÆ°á»i chÆ¡i 2 cá»™t cháº¯c cháº¯n vá»«a */
      .names{ grid-template-columns: repeat(auto-fill, minmax(160px, 1fr)) }

      /* Báº£ng vai trÃ²: thu cá»™t sá»‘ lÆ°á»£ng, trÃ¡nh trÃ n */
      :root{ --roles-cols: 1fr .6fr 90px auto }
      .roles input[type="number"]{ width:90px }

      /* Báº£ng phÃ¢n vai: cho wrap ná»™i dung */
      .assignments th, .assignments td{ padding:8px; font-size:13px; white-space:normal; word-break:break-word }
      .assignments td .btn{ padding:6px 10px }

      /* Bá»™ Ä‘áº¿m thá»i gian */
      #timerMin, #timerSec{ width:90px !important }
      .card, .card *{ max-width:100% }
    }

    /* ThÃªm chÃºt co láº¡i cho mÃ n ráº¥t nhá» */
    @media (max-width:360px){
      .names{ grid-template-columns: 1fr }  /* 1 cá»™t */
    }

    /* Co nháº¹ header trÃªn mÃ n ráº¥t háº¹p */
    @media (max-width:400px){
      header{ padding:12px 16px }
      header .title h1{ font-size:clamp(18px,4.8vw,30px) }
      .logo{ width:30px; height:30px }
    }

/* Mobile: Ä‘Æ°a cá»¥m nÃºt xuá»‘ng dÆ°á»›i input "Sá»‘ ngÆ°á»i chÆ¡i", cÄƒn giá»¯a vÃ  rÃºt khoáº£ng cÃ¡ch */
@media (max-width: 480px){

  /* hÃ ng chá»©a input + cá»¥m nÃºt */
  .row.wrap{
    align-items:flex-end;
  }

  /* cá»¥m 2 nÃºt thÃ nh 1 hÃ ng full-width, náº±m dÆ°á»›i vÃ  cÄƒn giá»¯a */
  .row.wrap > .row{
    flex: 0 0 100%;                 /* xuá»‘ng dÃ²ng dÆ°á»›i */
    justify-content:center;         /* cÄƒn giá»¯a 2 nÃºt */
    margin-top: 6px;                /* rÃºt khoáº£ng cÃ¡ch */
    gap: 8px;                       /* nÃºt sÃ¡t hÆ¡n */
  }

  /* tinh gá»n kÃ­ch thÆ°á»›c nÃºt */
  #autoFillNames, #shuffleNames{
    padding:8px 12px;
    font-size:14px;
    min-width:unset;
  }

  /* input sá»‘ ngÆ°á»i chÆ¡i khÃ´ng quÃ¡ to */
  #playerCount{ max-width: 220px; }
}

/* Tinh chá»‰nh báº£ng â€œDanh sÃ¡ch phÃ¢n vaiâ€ */
.assignments table th:nth-child(2),
.assignments table td:nth-child(2), /* Cá»™t TÃªn ngÆ°á»i chÆ¡i */
.assignments table th:nth-child(3),
.assignments table td:nth-child(3)  /* Cá»™t Vai trÃ² */
{
  padding-left: 6px;        /* giáº£m padding trÃ¡i */
  text-align: left;         /* cÄƒn tháº³ng lá» trÃ¡i */
}

/* Tuá»³ chá»n: chá»‰nh cá»™t sá»‘ thá»© tá»± sÃ¡t trÃ¡i luÃ´n */
.assignments table th:first-child,
.assignments table td:first-child{
  padding-left: 4px;
  text-align: center;
  width: 28px;              /* háº¹p láº¡i cá»™t # */
}

/* Chá»‰nh láº¡i cá»™t Tiáº¿t lá»™ Ä‘á»ƒ cá»™t Vai trÃ² thoÃ¡ng hÆ¡n */
.assignments table th:last-child,
.assignments table td:last-child {
  text-align: center;   /* cÄƒn giá»¯a nÃºt áº¨n/Hiá»‡n */
  width: 70px;          /* cá»‘ Ä‘á»‹nh chiá»u rá»™ng háº¹p láº¡i */
  padding-left: 4px;
  padding-right: 4px;
}

/* Cá»™t Vai trÃ² dá»‹ch trÃ¡i, khÃ´ng bá»‹ thá»¥t */
.assignments table th:nth-child(3),
.assignments table td:nth-child(3) {
  padding-left: 6px;
  text-align: left;
}

/* NÃºt + ThÃªm vai trÃ² -> xanh Ä‘á»“ng bá»™ vá»›i "Hiá»‡n" vÃ  "Báº¯t Ä‘áº§u" */
#addCustomRole {
  background: #0d2a22 !important;   /* xanh Ä‘áº­m */
  border-color: #13493b !important;
  color: #c7ffee !important;
}

/* NÃºt Máº·c Ä‘á»‹nh -> xÃ¡m tá»‘i hÆ¡n */
#resetRoles {
  background: #1a1c2b !important;   /* xÃ¡m tá»‘i */
  border-color: #2a2d40 !important;
  color: #d1d5db !important;        /* chá»¯ xÃ¡m nháº¡t dá»… Ä‘á»c */
}

/* Gom Ã´ nháº­p + 2 nÃºt vÃ o cÃ¹ng hÃ ng */
#playerCount {
  max-width: 100px;      /* thu nhá» Ã´ nháº­p */
  text-align: center;    /* canh giá»¯a sá»‘ */
}

/* Bá»‘ cá»¥c: input vÃ  2 nÃºt tháº³ng hÃ ng */
#playerCount, 
#autoFillNames, 
#shuffleNames {
  display: inline-block;
  vertical-align: middle;
  margin-top: 0;         /* bá» khoáº£ng cÃ¡ch thá»«a */
}

#autoFillNames, #shuffleNames {
  padding: 8px 12px;
  font-size: 14px;
  margin-left: 6px;      /* cÃ¡ch nháº¹ sang pháº£i */
}

/* === Sá»‘ ngÆ°á»i chÆ¡i + 2 nÃºt náº±m CÃ™NG HÃ€NG (má»i cá»¡ mÃ n) === */
.row.wrap { align-items: flex-end; }

/* Äá»«ng Ä‘á»ƒ .grow chiáº¿m háº¿t chiá»u ngang */
.row.wrap .grow{ 
  flex: 0 0 auto;          /* vá»«a Ä‘á»§ ná»™i dung */
  margin-right: 8px;
}

/* Cá»¥m hai nÃºt á»Ÿ ngay bÃªn pháº£i, khÃ´ng xuá»‘ng dÃ²ng */
.row.wrap > .row{
  flex: 0 0 auto;
  gap: 8px;
  margin-top: 0;           /* bá» khoáº£ng cÃ¡ch thá»«a */
}

/* Bá» wrapper + label rá»—ng cá»§a hai nÃºt Ä‘á»ƒ canh tháº³ng hÃ ng Ä‘áº¹p */
.row.wrap > .row > div{ display: contents; }
.row.wrap > .row label{ display: none; }

/* Thu nhá» vÃ  canh giá»¯a sá»‘ ngÆ°á»i chÆ¡i */
#playerCount{ 
  width: 100px;            /* hoáº·c 110px tuá»³ báº¡n */
  max-width: 100px;
  text-align: center;
}

/* NÃºt tinh gá»n chÃºt Ä‘á»ƒ vá»«a hÃ ng */
#autoFillNames, #shuffleNames{
  padding: 8px 12px;
  font-size: 14px;
}

/* Fallback mÃ u ná»n Ä‘áº·c khi gradient chÆ°a ká»‹p render */
html, body{
  background-color:#0a0f22;   /* trÃ¹ng tÃ´ng ná»n cuá»‘i cá»§a báº¡n */
}

/* Card dÃ¹ng ná»n Ä‘áº·c (Ã­t trong suá»‘t) Ä‘á»ƒ khÃ´ng lá»™ ná»n tráº¯ng khi cuá»™n */
.card{
  background: var(--card) !important;         /* #141832 */
  /* Náº¿u muá»‘n váº«n cÃ³ cáº£m giÃ¡c kÃ­nh má»:
  background: linear-gradient(180deg, rgba(20,24,50,.98), rgba(20,24,50,.96)) !important;
  */
}

/* TrÃªn thiáº¿t bá»‹ di Ä‘á»™ng: bá» blur Ä‘á»ƒ trÃ¡nh jank/flash tráº¯ng khi cuá»™n nhanh */
@media (max-width: 600px){
  header::before{
    backdrop-filter: none !important;
    -webkit-backdrop-filter: none !important;
    background: rgba(15,18,34,.60) !important; /* váº«n cÃ³ lá»›p má» tá»‘i */
  }
  header::after{ opacity:.6 !important; } /* nháº¹ hiá»‡u á»©ng sÃ¡ng Ä‘á»ƒ giáº£m paint */
}

/* ÄÆ°a cÃ¡c khá»‘i lá»›n lÃªn compositing layer Ä‘á»ƒ háº¡n cháº¿ checkerboard */
.container,
.card,
.assignments table{
  will-change: transform;
  transform: translateZ(0);
}

.assignments th,
.assignments td{ background-color: rgba(12,15,31,.98); }

/* Header cá»§a modal: cÄƒn tiÃªu Ä‘á» bÃªn trÃ¡i, nÃºt ÄÃ³ng bÃªn pháº£i */
.modal header{
  display: flex;
  align-items: center;
  justify-content: space-between;
  gap: 12px;
  padding: 12px 16px;           /* cÃ³ thá»ƒ giá»¯ nhÆ° cÅ© náº¿u báº¡n Ä‘Ã£ set */
  overflow: hidden;              /* giá»¯ theo thiáº¿t káº¿ ban Ä‘áº§u */
  border-radius: 12px 12px 0 0;  /* Ä‘áº£m báº£o bo gÃ³c trÃªn */
}

/* TiÃªu Ä‘á» co giÃ£n vÃ  cáº¯t ... khi dÃ i */
#roleModalTitle{
  margin: 0;
  font-size: 18px;
  line-height: 1.2;
  flex: 1 1 auto;                /* chiáº¿m pháº§n cÃ²n láº¡i */
  min-width: 0;                  /* Ä‘á»ƒ text-overflow hoáº¡t Ä‘á»™ng trong flex */
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
}

/* NÃºt ÄÃ³ng giá»¯ kÃ­ch thÆ°á»›c gá»n vÃ  khÃ´ng xuá»‘ng dÃ²ng */
.modal .close{
  flex: 0 0 auto;
  white-space: nowrap;
  margin-left: 8px;
}

/* CÄƒn giá»¯a 2 nÃºt "Äiá»n tÃªn máº·c Ä‘á»‹nh" vÃ  "XÃ¡o trá»™n danh sÃ¡ch" */
.row.wrap > .row{
  flex: 0 0 100%;        /* chiáº¿m toÃ n bá»™ chiá»u ngang */
  justify-content: center;
  margin-top: 6px;       /* khoáº£ng cÃ¡ch nháº¹ so vá»›i Ã´ nháº­p sá»‘ */
}

/* NÃºt "Äiá»n tÃªn máº·c Ä‘á»‹nh" -> xÃ¡m Ä‘áº­m */
#autoFillNames{
  background: #1a1c2b !important;   /* xÃ¡m tá»‘i */
  border-color: #2a2d40 !important;
  color: #d1d5db !important;        /* chá»¯ xÃ¡m nháº¡t dá»… Ä‘á»c */
}

/* NÃºt "XÃ¡o trá»™n tÃªn" -> xanh (giá»‘ng Hiá»‡n/Báº¯t Ä‘áº§u) */
#shuffleNames{
  background: #0d2a22 !important;   /* xanh Ä‘áº­m */
  border-color: #13493b !important;
  color: #c7ffee !important;        /* chá»¯ xanh nháº¡t */
}

/* CÄƒn giá»¯a label vÃ  Ã´ nháº­p "Sá»‘ ngÆ°á»i chÆ¡i" */
#playerCount{
  margin: 0 auto;        /* Ä‘Æ°a input vÃ o giá»¯a */
  display: block;
  text-align: center;
}

label[for="playerCount"]{
  display: block;
  text-align: center;    /* cÄƒn chá»¯ "Sá»‘ ngÆ°á»i chÆ¡i" giá»¯a */
}

/* === CÄƒn giá»¯a "Sá»‘ ngÆ°á»i chÆ¡i" + input + 2 nÃºt, chá»‰ á»Ÿ hÃ ng playerSetupRow === */
#playerSetupRow{
  align-items: flex-end;
  flex-wrap: wrap;
}

/* Label + input á»Ÿ giá»¯a, náº±m trÃªn cÃ¹ng má»™t cá»™t */
#playerSetupRow .grow{
  flex: 0 0 100%;
  text-align: center;
}
#playerSetupRow label[for="playerCount"]{
  display: block;
  margin: 10px 0 6px;       /* táº¡o khoáº£ng cÃ¡ch vá»›i dÃ²ng Máº¹o */
}
#playerSetupRow #playerCount{
  display: block;
  margin: 0 auto;           /* giá»¯a ngang */
  width: 110px;
  max-width: 110px;
  text-align: center;
}

/* Hai nÃºt á»Ÿ dÃ²ng dÆ°á»›i, cÄƒn giá»¯a */
#playerSetupRow > .row{
  flex: 0 0 100%;
  justify-content: center;
  gap: 8px;
  margin-top: 6px;
}
/* bá» label trá»‘ng bá»c nÃºt */
#playerSetupRow > .row > div{ display: contents; }
#playerSetupRow > .row label{ display: none; }

/* Highlight theo phe â€“ CHá»ˆ khi Ä‘Ã£ báº¥m Hiá»‡n */
.assignments tr.revealed.hl-wolf    td { background: rgba(239,68,68,.10); }   /* Phe sÃ³i */
.assignments tr.revealed.hl-village td { background: rgba(59,130,246,.10); }  /* Phe dÃ¢n */
.assignments tr.revealed.hl-flip    td { background: rgba(16,185,129,.10); }  /* Äá»•i phe */
.assignments tr.revealed.hl-third   td { background: rgba(234,179,8,.10); }   /* Phe 3 & custom */

/* --- NÃºt cho khu Ghi chÃº --- */
.notes-tools{ display:flex; gap:8px; flex-wrap:wrap; margin:8px 0 10px; }
.notes-tools .btn{ min-width:140px }

/* áº¨n vai trÃ²: Ä‘á»ƒ TRá»NG, khÃ´ng blur, váº«n giá»¯ chiá»u cao Ã´ */
.assignments td.role.hidden{
  filter: none !important;
  opacity: 1 !important;
  color: transparent !important;
  text-shadow: none !important;
}

/* Highlight theo phe â€“ CHá»ˆ khi Ä‘Ã£ báº¥m Hiá»‡n */
.assignments tr.revealed.f-wolf  td { background: rgba(239,68,68,.10); }  /* Phe sÃ³i */
.assignments tr.revealed.f-vil   td { background: rgba(59,130,246,.10); } /* Phe dÃ¢n */
.assignments tr.revealed.f-swap  td { background: rgba(16,185,129,.10); } /* Äá»•i phe */
.assignments tr.revealed.f-third td { background: rgba(234,179,8,.10); }  /* Phe 3 & custom */

/* ===== Cháº¿t / bá»‹ loáº¡i: tÃ´ Ä‘en Ä‘áº­m, Ä‘Ã¨ lÃªn má»i highlight ===== */
.assignments tr.dead td{
  background: #0a0c14 !important;   /* Ä‘en xanh Ä‘áº­m hÆ¡n (#0a0c14) */
  color: #8f97a8;                   /* chá»¯ xÃ¡m nháº¡t hÆ¡n Ä‘á»ƒ ná»•i báº­t */
}
.assignments tr.dead td .btn{
  opacity: .8;
  filter: brightness(0.9);          /* nÃºt cÅ©ng tá»‘i Ä‘i chÃºt */
}

/* áº¨n hiá»‡u á»©ng trang trÃ­ gÃ¢y trÃ n trÃªn mÃ n nhá» / vá»«a */
@media (max-width: 1024px){
  .container::after{ display:none !important; }
}

/* Báº£ng/Ã´ khÃ´ng trÃ n ngang */
.assignments table{
  table-layout: fixed;
  width: 100%;
}
.assignments th, .assignments td{
  overflow-wrap: anywhere;
  word-break: break-word;
}

/* Giá»¯ PhÃºt + GiÃ¢y cÃ¹ng hÃ ng */
#timerMin, #timerSec {
  width: 90px !important;     /* co nhá» chÃºt Ä‘á»ƒ cháº¯c cháº¯n vá»«a */
  min-width: 70px;            /* khÃ´ng nhá» quÃ¡ */
  display: inline-block;
}

#timerMin, #timerSec {
  box-sizing: border-box;
}

/* Bá»‘ cá»¥c hÃ ng timer: Ã©p khÃ´ng xuá»‘ng dÃ²ng */
#timerMin, #timerSec {
  flex: 0 0 auto;             /* giá»¯ cá»‘ Ä‘á»‹nh, khÃ´ng co kÃ©o */
}

#timerSec {
  margin-left: 8px;           /* táº¡o khoáº£ng cÃ¡ch vá»›i Ã´ phÃºt */
}

.timer-row {
  display: flex;
  flex-wrap: nowrap !important; /* Ã©p luÃ´n ngang */
  gap: 8px;
}

/* LÃ m Ã´ "Cháº¿ Ä‘á»™" rá»™ng hÆ¡n má»™t chÃºt */
#timerMode{
  width: 160px;          /* báº¡n cÃ³ thá»ƒ Ä‘á»•i 170â€“180px náº¿u thÃ­ch */
  min-width: 150px;
  display: inline-block;
}

/* CÄƒn Cáº¢ 3 Ã´ (Cháº¿ Ä‘á»™ / PhÃºt / GiÃ¢y) vÃ o chÃ­nh giá»¯a hÃ ng */
.timer-row{
  display: flex;
  justify-content: center;   /* Ctrl + E */
  gap: 12px;                 /* khoáº£ng cÃ¡ch giá»¯a cÃ¡c Ã´ */
}

/* Äá»«ng Ä‘á»ƒ .grow Ä‘áº©y lá»‡ch sang trÃ¡i trong hÃ ng timer */
.timer-row .grow{
  flex: 0 0 auto;            /* chá»‰ vá»«a ná»™i dung */
  text-align: center;        /* label vÃ  select Ä‘á»u giá»¯a */
}

/* Cho Ä‘áº¹p: cÄƒn giá»¯a label + input cá»§a 2 cá»™t PhÃºt/GiÃ¢y */
.timer-row > div{
  text-align: center;
}

/* Giá»¯ PhÃºt/GiÃ¢y khÃ´ng xuá»‘ng hÃ ng (náº¿u báº¡n chÆ°a cÃ³) */
#timerMin, #timerSec{
  width: 110px !important;
  min-width: 90px;
  flex: 0 0 auto;
}

/* CÄƒn giá»¯a 2 nÃºt "XÃ³a táº¥t cáº£" vÃ  "Soáº¡n máº«u nhanh" */
.notes-tools{
  display: flex;
  justify-content: center;  /* Ctrl + E */
  gap: 12px;                /* khoáº£ng cÃ¡ch giá»¯a nÃºt */
  margin: 8px 0 10px;
}

/* Cho cÃ¡c nÃºt Ä‘á»“ng Ä‘á»u */
.notes-tools .btn{
  min-width: 140px;
  text-align: center;
}

/* Chá»¯ "â€“ Bá»Š LOáº I" */
.assignments td .eliminated {
  color: #ff6b6b;       /* Ä‘á» nháº¡t cáº£nh bÃ¡o */
  font-weight: 600;
  margin-left: 6px;
  font-size: 0.9em;
  opacity: 0.9;
}

/* td giá»¯ kiá»ƒu báº£ng, khÃ´ng flex */
.assignments td.name-cell{
  display: table-cell !important;   /* Ã©p vá» table-cell Ä‘á»ƒ khÃ´ng phÃ¡ layout */
  vertical-align: middle;
  padding-left: 6px;
}

/* wrapper bÃªn trong chia 2 phÃ­a: TÃªn | â€“ Bá»Š LOáº I */
.assignments td.name-cell .name-wrap{
  display: flex;
  justify-content: space-between;
  align-items: center;
  gap: 12px;
  width: 100%;
  min-width: 0;
}

/* TÃªn cáº¯t ... khi dÃ i */
.assignments td.name-cell .player-name{
  overflow: hidden;
  text-overflow: ellipsis;
  white-space: nowrap;
}

/* NhÃ£n â€“ Bá»Š LOáº I */
.assignments td.name-cell .eliminated{
  color: #ff6b6b;
  font-weight: 700;
  font-size: .92em;
  white-space: nowrap;
  margin-left: 12px;
}

/* Chá»¯ Bá»Š LOáº I ná»•i báº­t */
.assignments td .eliminated {
  color: #ff6b6b;
  font-weight: 600;
  font-size: 0.9em;
  white-space: nowrap;
}

/* td giá»¯ kiá»ƒu báº£ng, khÃ´ng flex */
.assignments td.name-cell {
  vertical-align: middle;
  padding-left: 6px;  /* tuá»³ chá»‰nh */
}

/* wrapper má»›i bÃªn trong Ä‘á»ƒ chia 2 bÃªn */
.assignments td.name-cell .name-wrap {
  display: flex;
  justify-content: space-between;
  align-items: center;
  gap: 10px;
  width: 100%;
  min-width: 0;
}

/* TÃªn bá»‹ cáº¯t ... náº¿u dÃ i */
.assignments td.name-cell .player-name {
  overflow: hidden;
  text-overflow: ellipsis;
  white-space: nowrap;
}

/* NhÃ£n Bá»Š LOáº I */
.assignments td.name-cell .eliminated {
  color: #ff6b6b;
  font-weight: 700;
  font-size: .92em;
  white-space: nowrap;
  margin-left: 12px;
}

/* --- MOBILE HARDEN KIT: chá»‘ng trÃ n & co giÃ£n an toÃ n --- */

/* 1) CÃ¡c item trong flex/grid máº·c Ä‘á»‹nh Ä‘Æ°á»£c phÃ©p co láº¡i */
.grid > *, .row > *, .section-title > *, .tools > *,
.roles .item > *, .assignments table th, .assignments table td {
  min-width: 0;
}

/* 2) VÄƒn báº£n dÃ i cÃ³ thá»ƒ xuá»‘ng dÃ²ng & cáº¯t ... khi cáº§n */
:where(h1,h2,h3,h4,h5,p,div,span,button,td,th,label){
  overflow-wrap: anywhere;
  word-break: break-word;
  text-wrap: balance;        /* Ä‘áº¹p trÃªn trÃ¬nh duyá»‡t má»›i */
}

/* 3) HÃ¬nh/ SVG khÃ´ng vÆ°á»£t chiá»u ngang */
img, svg, video, canvas { max-width: 100%; height: auto; }

/* 4) KhÃ´ng cho pháº§n tá»­ nÃ o táº¡o thanh cuá»™n ngang ngoÃ i Ã½ muá»‘n */
html, body, .container { overflow-x: hidden; }

/* 5) Header & container tÃ´n trá»ng safe-area (tai thá» iPhone) */
header {
  padding-left: calc(16px + env(safe-area-inset-left, 0px));
  padding-right: calc(16px + env(safe-area-inset-right, 0px));
}
.container {
  padding-left: calc(16px + env(safe-area-inset-left, 0px));
  padding-right: calc(16px + env(safe-area-inset-right, 0px));
}

/* 6) Vai trÃ² (grid) luÃ´n â€œlá»tâ€ mÃ n â€“ cho cá»™t sá»‘ lÆ°á»£ng co nhá» */
:root { --roles-cols: 1.1fr .8fr 110px auto; }
@media (max-width: 480px){
  :root { --roles-cols: 1fr .8fr 90px auto; }
  .roles input[type="number"]{ max-width: 90px; }
}

/* 7) TÃªn ngÆ°á»i chÆ¡i â€“ lÆ°á»›i khÃ´ng trÃ n */
.names { grid-template-columns: repeat(auto-fill, minmax(150px,1fr)); }
@media (max-width: 360px){ .names { grid-template-columns: 1fr; } }

/* 8) Báº£ng phÃ¢n vai: cho phÃ©p wrap & Ã©p cá»™t nÃºt háº¹p hÆ¡n trÃªn mÃ n nhá» */
.assignments table { table-layout: fixed; width: 100%; }
.assignments th, .assignments td { white-space: normal; }   /* cho xuá»‘ng dÃ²ng khi cáº§n */
@media (max-width: 420px){
  .assignments table th:last-child,
  .assignments table td:last-child { width: 60px; }          /* nÃºt nhá» hÆ¡n chÃºt */
  .assignments td .btn{ padding:6px 8px; font-size:13px; }
}

/* 9) HÃ ng timer: co Ä‘á»u, khÃ´ng Ä‘áº©y trÃ n */
.timer-row { flex-wrap: nowrap; gap: 8px; }
.timer-row > * { min-width: 0; }          /* cho phÃ©p co */
#timerMode, #timerMin, #timerSec { width: auto; }
@media (max-width: 360px){
  #timerMode{ min-width: 120px; }
  #timerMin, #timerSec{ min-width: 84px; }
}

/* 10) NÃºt dÃ i/nhÃ£n dÃ i váº«n co gá»n */
.btn { max-width: 100%; white-space: nowrap; text-overflow: ellipsis; overflow: hidden; }

/* 11) Trang trÃ­ ná»n khÃ´ng gÃ¢y trÃ n (Ä‘Ã£ áº©n <=1024, nhÆ°ng cháº·n thÃªm) */
.container::after { pointer-events:none; max-width: 100dvw; }

/* 12) TrÆ°á»ng há»£p cá»±c Ä‘oan (<340px): bá»c báº£ng Ä‘á»ƒ khÃ´ng táº¡o trÃ n toÃ n trang */
@media (max-width: 340px){
  .table-wrap{ width:100%; overflow-x:auto; -webkit-overflow-scrolling:touch; }
  .table-wrap table{ min-width: 440px; }  /* chá»‰ cuá»™n ngang bÃªn trong khi Ráº¤T háº¹p */
}

/* === Thu nhá» Ã´ nháº­p PhÃºt & GiÃ¢y === */
#timerMin,
#timerSec {
  width: 70px !important;    /* nhá» hÆ¡n (trÆ°á»›c báº¡n Ä‘á»ƒ 90â€“110px) */
  max-width: 80px;
  text-align: center;
  padding: 6px 8px;          /* giáº£m padding bÃªn trong */
  font-size: 15px;           /* chá»¯ nhá» gá»n vá»«a máº¯t */
}

/* Mobile: Ã©p nhá» hÆ¡n ná»¯a náº¿u mÃ n ráº¥t háº¹p */
@media (max-width: 420px) {
  #timerMin,
  #timerSec {
    width: 60px !important;
    font-size: 14px;
  }
}

/* === Thu gá»n cá»™t MÃ´ táº£ & Sá»‘ lÆ°á»£ng Ä‘á»ƒ nhÆ°á»ng chá»— cho Vai trÃ² === */
.roles {
  grid-template-columns: 1.2fr 0.6fr 80px auto; /* Vai trÃ² | MÃ´ táº£ | Sá»‘ lÆ°á»£ng | (xÃ³a) */
  gap: 8px;
}

/* Ã” nháº­p sá»‘ lÆ°á»£ng nhá» láº¡i */
.roles input[type="number"] {
  width: 70px !important;   /* gá»n hÆ¡n (trÆ°á»›c lÃ  120px) */
  max-width: 80px;
  text-align: center;
  padding: 4px 6px;
  font-size: 15px;
}

/* NÃºt "Hiá»‡n" trong cá»™t MÃ´ táº£ */
.roles .item button {
  min-width: 70px;          /* nÃºt nhá» hÆ¡n */
  padding: 6px 10px;
  font-size: 14px;
  text-align: center;
}

/* TrÃªn mÃ n háº¹p hÆ¡n 480px, Ã©p nhá» hÆ¡n ná»¯a */
@media (max-width: 480px) {
  .roles {
    grid-template-columns: 1fr 0.6fr 60px auto;
  }
  .roles input[type="number"] {
    width: 60px !important;
    font-size: 14px;
  }
  .roles .item button {
    min-width: 60px;
    font-size: 13px;
    padding: 5px 8px;
  }
}

/* CÄƒn giá»¯a dÃ²ng ghi chÃº */
.hint {
  text-align: center;
}

/* áº¨n Ã´ Máº¹o */
.section-title .chip {
  display: none !important;
}

/* ==== TIMER: 3 Ã´ tháº³ng hÃ ng, cao báº±ng nhau, khÃ´ng trÃ n pháº£i ==== */

/* Bá» má»i width cá»©ng trÆ°á»›c Ä‘Ã³ */
#timerMode,
#timerMin,
#timerSec{
  width: 100% !important;   /* Ä‘á»ƒ cá»™t quyáº¿t Ä‘á»‹nh bá» ngang */
  min-width: 0 !important;
  max-width: 100% !important;
}

/* ==== TIMER: 3 Ã´ tháº³ng hÃ ng, cao báº±ng nhau, GiÃ¢y sÃ¡t PhÃºt ==== */
.timer-row{
  display: grid !important;
  grid-template-columns: minmax(160px,1fr) 80px 80px; /* cháº¿ Ä‘á»™ | phÃºt | giÃ¢y */
  grid-template-areas: "mode min sec";
  column-gap: 8px;          /* khoáº£ng cÃ¡ch chung */
  align-items: end;
}

.timer-row > div:nth-child(2){ grid-area: min; }
.timer-row > div:nth-child(3){ grid-area: sec; }

/* Thu háº¹p khoáº£ng cÃ¡ch giá»¯a PhÃºt vÃ  GiÃ¢y */
.timer-row > div:nth-child(2),
.timer-row > div:nth-child(3){
  margin-right: 0;          /* khÃ´ng cÃ³ dÆ° bÃªn pháº£i */
}
.timer-row > div:nth-child(2){ margin-right: 4px; } /* chá»‰ cÃ¡ch nháº¹ giá»¯a PhÃºt vÃ  GiÃ¢y */

.timer-row select,
.timer-row input[type="number"]{
  height: 44px;
  padding: 10px 12px;
  border-radius: 12px;
  text-align: center;
  box-sizing: border-box;
}

.timer-row label{
  display:block;
  margin: 6px 2px;
  text-align:center;
}

/* MÃ n nhá» */
@media (max-width: 400px){
  .timer-row{
    grid-template-columns: minmax(140px,1fr) 70px 70px;
    column-gap: 6px;        /* háº¹p hÆ¡n ná»¯a */
  }
  .timer-row select,
  .timer-row input[type="number"]{ height: 40px; font-size: 15px; }
}

/* CÄƒn giá»¯a nhÃ£n + input cá»§a cá»™t GiÃ¢y */
.timer-row > div:nth-child(3) {
  text-align: center;    /* nhÃ£n GiÃ¢y cÄƒn giá»¯a */
  justify-self: center;  /* Ã´ nháº­p liá»‡u GiÃ¢y cÄƒn giá»¯a theo cá»™t */
}

/* Äáº£m báº£o input khÃ´ng bá»‹ kÃ©o lá»‡ch */
#timerSec {
  margin-left: 0 !important;
}

  </style>
</head>
<body>
  <header>
    <div class="title">
      <div class="top-row">
        <div class="logo" aria-hidden="true">
          <img src="https://play-lh.googleusercontent.com/NoTmMzso2UYOdoaLcADzE6eRnZaKpfz_gTcFsJMBQyLB09Q_J8I0aLWRlTi6RZpTdO33" alt="Logo SÃ³i">
        </div>
        <h1>Trá»£ Thá»§ Quáº£n TrÃ² ğŸºğŸ²</h1>
      </div>
      <div class="chip" title="Dá»¯ liá»‡u Ä‘Æ°á»£c lÆ°u tá»± Ä‘á»™ng trong trÃ¬nh duyá»‡t">Created by Dang Khoa â¤ï¸</div>
    </div>
  </header>

  <div class="container grid">
    <!-- LEFT: SETUP + ASSIGNMENT -->
    <section class="card">
      <div class="section-title">
        <h2>ğŸ‘¤ Thiáº¿t láº­p ngÆ°á»i chÆ¡i</h2>
        <div class="chip">Máº¹o: <span class="kbd">Tab</span> Ä‘á»ƒ chuyá»ƒn nhanh giá»¯a cÃ¡c Ã´ tÃªn trÃªn mÃ¡y tÃ­nh.</div>
      </div>

      <div class="row wrap" id="playerSetupRow">
        <div class="grow">
          <label for="playerCount">Sá»‘ ngÆ°á»i chÆ¡i</label>
          <input id="playerCount" type="number" min="3" max="40" value="10" />
        </div>
        <div class="row" style="gap:8px; align-items:flex-end">
          <div>
            <label>&nbsp;</label>
            <button class="btn" id="autoFillNames">Äiá»n tÃªn máº·c Ä‘á»‹nh</button>
          </div>
          <div>
            <label>&nbsp;</label>
            <button class="btn" id="shuffleNames">XÃ¡o trá»™n danh sÃ¡ch</button>
          </div>
          <div>
            <label>&nbsp;</label>
            <button class="btn danger" id="removeEmptyNames">XÃ³a tÃªn ngÆ°á»i chÆ¡i</button>
          </div>
        </div>
      </div>

      <label>Danh sÃ¡ch tÃªn ngÆ°á»i chÆ¡i</label>
      <div id="names" class="names"></div>

      <hr style="border-color:#28305633; margin:16px 0">

      <!-- Header khu vai trÃ² -->
      <div class="section-title roles-head">
        <h2>ğŸƒ Thiáº¿t láº­p vai trÃ²</h2>
        <div class="chip">CÃ²n trá»‘ng: <b id="slotsLeft">0</b></div>
      </div>

      <div class="roles" role="table" aria-label="Báº£ng vai trÃ²">
        <div class="header">Vai trÃ²</div>
        <div class="header">MÃ´ táº£</div>
        <div class="header">Sá»‘ lÆ°á»£ng</div>
        <div class="header">&nbsp;</div>
        <div id="rolesList"></div>
      </div>

      <div class="row wrap" style="margin-top:8px" id="customRoleRow">
        <div class="grow row">
          <input id="customRoleName" type="text" placeholder="ThÃªm vai trÃ² má»›i (vÃ­ dá»¥: Bá»‹ nguyá»n rá»§a)" />
          <input id="customRoleCount" type="number" min="1" value="1" />
        </div>
        <div id="customRoleActions" class="row">
          <button class="btn" id="addCustomRole">+ ThÃªm vai trÃ²</button>
          <button class="btn ghost" id="resetRoles" title="ÄÆ°a vai trÃ² vá» máº·c Ä‘á»‹nh">Máº·c Ä‘á»‹nh</button>
        </div>
      </div>

      <div class="hint" style="margin:6px">Náº¿u tá»•ng vai trÃ² vÆ°á»£t quÃ¡ sá»‘ ngÆ°á»i, báº¡n sáº½ Ä‘Æ°á»£c nháº¯c Ä‘iá»u chá»‰nh. Ã” trá»‘ng sáº½ tá»± láº¥p báº±ng vai trÃ² <b>DÃ¢n lÃ ng</b>.</div>

      <div class="tools no-print" style="margin-top:12px">
        <button class="btn primary" id="assignBtn">ğŸ² Chia vai trÃ² ngáº«u nhiÃªn</button>
        <button class="btn" id="reshuffleBtn" disabled>ğŸ”€ Trá»™n láº¡i</button>
        <button class="btn" id="revealAllBtn" disabled>ğŸ‘ï¸â€ğŸ—¨ï¸ Hiá»‡n/áº¨n táº¥t cáº£</button>
        <button class="btn" id="copyBtn" disabled>ğŸ“‹ Sao chÃ©p</button>
        <!-- Äá»•i nÃºt In thÃ nh nÃºt Sáº¯p xáº¿p -->
        <button class="btn" id="sortBtn" disabled>â†•ï¸ Sáº¯p xáº¿p</button>
      </div>

      <div class="assignments" id="assignments" style="margin-top:8px"></div>
    </section>

    <!-- RIGHT: TIMER + NOTES -->
    <aside class="card">
      <div class="section-title">
        <h2>â³ï¸ Bá»™ Ä‘áº¿m thá»i gian</h2>
        <div class="row">
          <label class="chip" style="cursor:pointer"><input id="soundToggle" type="checkbox" checked style="margin-right:8px">ChuÃ´ng</label>
        </div>
      </div>

      <div class="row wrap timer-row">
  <div class="grow">
    <label>Cháº¿ Ä‘á»™</label>
    <select id="timerMode">
      <option value="down">Äáº¿m ngÆ°á»£c</option>
      <option value="up">Äáº¿m xuÃ´i</option>
    </select>
  </div>
  <div>
    <label>PhÃºt</label>
    <input id="timerMin" type="number" min="0" value="2">
  </div>
  <div>
    <label>GiÃ¢y</label>
    <input id="timerSec" type="number" min="0" max="59" value="0">
  </div>
</div>

      <div class="timer-big" id="timerDisplay">02:00</div>
      <div class="timer-controls no-print">
        <button class="btn ok" id="startPauseBtn">â–¶ï¸ Báº¯t Ä‘áº§u</button>
        <button class="btn" id="resetTimerBtn">âŸ² Äáº·t láº¡i</button>
        <button class="btn" data-preset="30">Biá»‡n há»™ (30s)</button>
        <button class="btn" data-preset="120">Tháº£o luáº­n (2â€™)</button>
        <button class="btn" data-preset="180">Tháº£o luáº­n (3â€™)</button>
        <button class="btn" data-preset="300">Tháº£o luáº­n (5â€™)</button>
      </div>

      <hr style="border-color:#28305633; margin:18px 0">

      <h2>ğŸ—’ï¸ Ghi chÃº</h2>
      <!-- NÃºt má»›i cho ghi chÃº -->
      <div class="notes-tools no-print">
        <button class="btn danger" id="clearNotesBtn">ğŸ—‘ï¸ XÃ³a táº¥t cáº£</button>
        <button class="btn" id="quickTemplateBtn">âœï¸ Soáº¡n máº«u nhanh</button>
      </div>
      <textarea id="notes" placeholder="Ghi chÃº: ai bá»‹ treo cá»•, ai bá»‹ sÃ³i cáº¯n, lÃ¡ phiáº¿u, v.v."></textarea>
    </aside>
  </div>

  <div class="footer no-print">Created by Dang Khoa â¤ï¸ â€“ LÆ°u tá»± Ä‘á»™ng, hoáº¡t Ä‘á»™ng offline.</div>

  <!-- Modal xem mÃ´ táº£ vai -->
  <div id="roleModal" class="modal-backdrop" aria-hidden="true" role="dialog" aria-modal="true">
    <div class="modal" role="document">
      <header>
        <h3 id="roleModalTitle">Vai trÃ²</h3>
        <button class="close" id="roleModalClose">ÄÃ³ng</button>
      </header>
      <div class="content" id="roleModalBody"></div>
    </div>
  </div>

<script>
(function(){
  const qs = (s, el=document)=>el.querySelector(s);
  const qsa = (s, el=document)=>Array.from(el.querySelectorAll(s));
  const $ = {
    playerCount: qs('#playerCount'),
    namesWrap: qs('#names'),
    autoFillNames: qs('#autoFillNames'),
    shuffleNames: qs('#shuffleNames'),
    removeEmptyNames: qs('#removeEmptyNames'),
    rolesList: qs('#rolesList'),
    slotsLeft: qs('#slotsLeft'),
    addCustomRole: qs('#addCustomRole'),
    customRoleName: qs('#customRoleName'),
    customRoleCount: qs('#customRoleCount'),
    resetRoles: qs('#resetRoles'),

    assignBtn: qs('#assignBtn'),
    reshuffleBtn: qs('#reshuffleBtn'),
    revealAllBtn: qs('#revealAllBtn'),
    copyBtn: qs('#copyBtn'),
    sortBtn: qs('#sortBtn'),
    assignments: qs('#assignments'),

    // Timer
    timerMode: qs('#timerMode'),
    timerMin: qs('#timerMin'),
    timerSec: qs('#timerSec'),
    timerDisplay: qs('#timerDisplay'),
    startPauseBtn: qs('#startPauseBtn'),
    resetTimerBtn: qs('#resetTimerBtn'),
    soundToggle: qs('#soundToggle'),

    // Notes buttons
    clearNotesBtn: qs('#clearNotesBtn'),
    quickTemplateBtn: qs('#quickTemplateBtn'),
  };

  // ===== Modal helpers =====
  const modal = {
    wrap: document.getElementById('roleModal'),
    title: document.getElementById('roleModalTitle'),
    body: document.getElementById('roleModalBody'),
    btnClose: document.getElementById('roleModalClose'),
    open(title, text){
      this.title.textContent = title || 'Vai trÃ²';
      this.body.textContent = text || '';
      this.wrap.classList.add('show');
      this.wrap.setAttribute('aria-hidden','false');
      this.btnClose.focus();
    },
    close(){ this.wrap.classList.remove('show'); this.wrap.setAttribute('aria-hidden','true'); }
  };
  modal.btnClose.addEventListener('click', ()=>modal.close());
  modal.wrap.addEventListener('click', (e)=>{ if(e.target === modal.wrap) modal.close(); });
  document.addEventListener('keydown', (e)=>{ if(e.key === 'Escape') modal.close(); });

  // ====== STATE ======
  const STORAGE_KEY = 'werewolf_mod_state_v1';
  let STATE = {
    playerCount: 10,
    names: [],
    roles: {},          // {key: count}
    customRoles: {},    // {name: count}
    assignments: null,
    reveal: {},         // {index: bool}
    dead: {},
    notes: '',
    timer: {mode:'down', min:2, sec:0, running:false, left:120, sound:true},
  };

  // Default roles
  const DEFAULT_ROLES = [
    { key:'cupid', name:'ğŸ’˜ Tháº§n tÃ¬nh yÃªu', hint:'Thá»©c dáº­y vÃ o Ä‘Ãªm Ä‘áº§u tiÃªn vÃ  chá»n ra 2 ngÆ°á»i chÆ¡i ( Ä‘Æ°á»£c phÃ©p chá»n cáº£ mÃ¬nh). Hai ngÆ°á»i Ä‘Æ°á»£c chá»n sáº½ trá»Ÿ thÃ nh 2 ngÆ°á»i yÃªu nhau. Náº¿u má»™t trong hai ngÆ°á»i nÃ y cháº¿t, ngÆ°á»i cÃ²n láº¡i cÅ©ng sáº½ cháº¿t theo.', color:'#e91e63' },
    { key:'werewolf', name:'ğŸº SÃ³i', hint:'VÃ o ban Ä‘Ãªm, Ma sÃ³i sáº½ tá»‰nh dáº­y cÃ¹ng nhau vÃ  thá»‘ng nháº¥t giáº¿t 1 náº¡n nháº­n nÃ o Ä‘Ã³. SÃ³i cÃ³ thá»ƒ khÃ´ng giáº¿t ngÆ°á»i nÃ o vÃ  khÃ´ng Ä‘Æ°á»£c giáº¿t sÃ³i khÃ¡c.', color:'#d32f2f' },
    { key:'werecub', name:'ğŸº SÃ³i con', hint:'SÃ³i con lÃ  SÃ³i vÃ  thá»©c dáº­y cÃ¹ng SÃ³i má»—i Ä‘Ãªm. Náº¿u SÃ³i con bá»‹ giáº¿t, SÃ³i cÃ²n láº¡i sáº½ giáº¿t 2 ngÆ°á»i vÃ o Ä‘Ãªm hÃ´m sau. SÃ³i cÃ³ thá»ƒ chá»n giáº¿t SÃ³i Con nhÆ° 1 sá»± hy sinh ( Táº¥t cáº£ SÃ³i bao gá»“m cáº£ SÃ³i con Ä‘á»u Ä‘á»“ng Ã½ viá»‡c Ä‘Ã³). Khi Ä‘Ã³ SÃ³i cÃ³ thá»ƒ láº­p tá»©c giáº¿t 2 ngÆ°á»i chÆ¡i khÃ¡c vÃ o ngay Ä‘Ãªm hÃ´m Ä‘Ã³.', color:'#ff7043' },
    { key:'minion', name:'ğŸ­ï¸ Káº» pháº£n bá»™i', hint:'Pháº£n bá»™i thá»©c dáº­y cÃ¹ng SÃ³i vÃ  biáº¿t SÃ³i lÃ  ai. Tham gia cÃ¹ng SÃ³i Ä‘á»ƒ giáº¿t DÃ¢n lÃ ng. Tuy nhiÃªn TiÃªn tri khi soi vÃ o Pháº£n bá»™i thÃ¬ váº«n ra dÃ¢n lÃ ng.', color:'#6d4c41' },
    { key:'seer', name:'ğŸ”® TiÃªn tri', hint:'Má»—i Ä‘Ãªm, TiÃªn tri chá»‰ tay vÃ o má»™t ngÆ°á»i. Quáº£n trÃ² sáº½ cho TiÃªn tri biáº¿t ngÆ°á»i Ä‘Ã³ cÃ³ pháº£i lÃ  Ma sÃ³i hay khÃ´ng.', color:'#3f51b5' },
    { key:'witch', name:'ğŸ§™â€â™‚ï¸ PhÃ¹ thuá»·', hint:'PhÃ¹ thá»§y sáº½ cÃ³ hai bÃ¬nh thuá»‘c. Má»™t bÃ¬nh thuá»‘c Ä‘á»ƒ cá»©u 1 ngÆ°á»i vÃ  má»™t bÃ¬nh thuá»‘c Ä‘á»ƒ giáº¿t 1 ngÆ°á»i. Trong Ä‘Ãªm, Quáº£n trÃ² seÌƒ cho PhuÌ€ ThuÌ‰y biÃªÌt ai seÌƒ biÌ£ giÃªÌt trong Ä‘Ãªm vaÌ€ há»i xem PhÃ¹ thá»§y cÃ³ muá»‘n sá»­ dá»¥ng quyá»n nÄƒng nÃ o hay khÃ´ng. CÃ³ thá»ƒ dÃ¹ng cáº£ hai bÃ¬nh thuá»‘c nÃ y vÃ o cÃ¹ng 1 Ä‘Ãªm, nhÆ°ng mÃ´Ìƒi biÌ€nh chiÌ‰ duÌ€ng mÃ´Ì£t lÃ¢Ì€n.', color:'#9c27b0' },
    { key:'hunter', name:'ğŸ¹ Thá»£ sÄƒn', hint:'Náº¿u thá»£ sÄƒn cháº¿t, háº¯n láº­p tá»©c Ä‘Æ°á»£c phÃ©p nháº¯m vÃ o má»™t ngÆ°á»i vÃ  ngÆ°á»i nÃ y sáº½ bá»‹ cháº¿t. Náº¿u thá»£ sÄƒn cháº¿t trong Ä‘Ãªm, Quáº£n trÃ² sáº½ Ä‘á»¥ng vai Thá»£ sÄƒn Ä‘á»ƒ bÃ¡o Thá»£ sÄƒn nháº¯m báº¯n.', color:'#ff9800' },
    { key:'guard', name:'ğŸ›¡ï¸ Báº£o vá»‡', hint:'Má»—i Ä‘Ãªm, Báº£o vá»‡ chá»n má»™t ngÆ°á»i khÃ¡c nhau Ä‘á»ƒ báº£o vá»‡. NgÆ°á»i chÆ¡i nÃ y sáº½ báº¥t tá»­ vÃ o Ä‘Ãªm Ä‘Ã³ (nhÆ°ng khÃ´ng thá»ƒ báº£o vá»‡ khá»i PhÃ¹ Thá»§y).', color:'#4caf50' },
    { key:'spellcaster', name:'ğŸ”‡ PhÃ¡p sÆ° cÃ¢m', hint:'Má»—i Ä‘Ãªm, PhÃ¡p sÆ° cÃ¢m sáº½ Ä‘Æ°á»£c phÃ©p chá»‰ Ä‘á»‹nh 1 ngÆ°á»i bá»‹ cÃ¢m vÃ o hÃ´m sau. NgÆ°á»i nÃ y vÃ o ngÃ y hÃ´m sau sáº½ khÃ´ng Ä‘Æ°á»£c nÃ³i. ', color:'#009688' },
    { key:'doppelganger', name:'ğŸ‘¥ NhÃ¢n báº£n', hint:'VÃ o Ä‘Ãªm Ä‘áº§u tiÃªn, NhÃ¢n báº£n tá»‰nh dáº­y vÃ  lá»±a chá»n má»™t ngÆ°á»i chÆ¡i. Náº¿u ngÆ°á»i chÆ¡i kia cháº¿t trong Ä‘Ãªm, NhÃ¢n báº£n sáº½ bÃ­ máº­t láº¥y chá»©c nÄƒng cá»§a ngÆ°á»i Ä‘Ã³. TrÆ°á»›c khi cÃ³ chá»©c nÄƒng má»›i, NhÃ¢n báº£n theo Phe dÃ¢n. Sau khi cÃ³ chá»©c nÄƒng má»›i, NhÃ¢n báº£n theo phe cá»§a chá»©c nÄƒng nÃ y. ', color:'#607d8b' },
    { key:'cursed', name:'ğŸŒ‘ Káº» bá»‹ nguyá»n', hint:'Káº» bá»‹ Nguyá»n rá»§a ban Ä‘áº§u lÃ  ngÆ°á»i, TiÃªn tri soi cÅ©ng ra ngÆ°á»i. Náº¿u Káº» bá»‹ Nguyá»n rá»§a bá»‹ SÃ³i cáº¯n thÃ¬ sáº½ khÃ´ng cháº¿t, mÃ  tá»« Ä‘Ãªm tiáº¿p theo sáº½ biáº¿n thÃ nh SÃ³i, Ä‘á»“ng thá»i náº¿u TiÃªn tri sÃ³i thÃ¬ cÅ©ng sáº½ lÃ  SÃ³i. Káº» bá»‹ Nguyá»n rá»§a má»—i Ä‘Ãªm Ä‘Æ°á»£c gá»i dáº­y riÃªng biá»‡t, ká»ƒ cáº£ sau khi hÃ³a SÃ³i, Ä‘á»ƒ cho ngÆ°á»i nÃ y biáº¿t Ä‘Ã£ bá»‹ hÃ³a SÃ³i hay chÆ°a. ', color:'#673ab7' },
    { key:'tanner', name:'ğŸ˜“ ChÃ¡n Ä‘á»i', hint:'ChÃ¡n Ä‘á»i chá»‰ tháº¯ng khi anh ta bá»‹ giáº¿t. CÃ¡c Ä‘iá»u kiá»‡n tháº¯ng khÃ¡c cÅ©ng Ä‘Æ°á»£c Ã¡p dá»¥ng. ', color:'#795548' },
    { key:'village', name:'ğŸ‘¨ğŸ»â€ğŸŒ¾ DÃ¢n lÃ ng', hint:'KhÃ´ng cÃ³ tÃ­nh nÄƒng Ä‘áº·c biá»‡t nÃ o cáº£, ngá»§ suá»‘t Ä‘Ãªm vÃ  tham gia biá»ƒu quyáº¿t tÃ¬m SÃ³i vÃ o ban ngÃ y. ', color:'#8bc34a' },
    { key:'prince', name:'ğŸ‘‘ HoÃ ng tá»­', hint:'HoÃ ng tá»­ khÃ´ng thá»ƒ bá»‹ treo cá»• cháº¿t. VÃ o láº§n bá»‹ vote cháº¿t vÃ  chuáº©n bá»‹ treo cá»•, ngÆ°á»i nÃ y sáº½ láº­t lÃ¡ bÃ i lÃªn Ä‘á»ƒ má»i ngÆ°á»i Ä‘Æ°á»£c tháº¥y vÃ  khÃ´ng pháº£i chá»‹u treo cá»•. Táº¥t cáº£ ngÆ°á»i chÆ¡i láº­p tá»©c Ä‘i ngá»§. ', color:'#fbc02d' },
    { key:'elder', name:'ğŸ‘´ GiÃ  lÃ ng', hint:'GiÃ  lÃ ng cÃ³ 2 máº¡ng sá»‘ng. Náº¿u cháº¿t cáº£ 2 láº§n thÃ¬ cÃ¡c quyá»n nÄƒng (tiÃªn tri, báº£o vá»‡,â€¦) cá»§a nhÃ¢n váº­t khÃ¡c sáº½ máº¥t Ä‘i.', color:'#ffffff' },
    { key:'tough guy', name:'ğŸ’ª Lá»±c sÄ©', hint:'Náº¿u bá»‹ SÃ³i cáº¯n, Lá»±c sÄ© sáº½ cháº¿t vÃ o Ä‘Ãªm tiáº¿p theo chá»© khÃ´ng pháº£i ngay táº¡i Ä‘Ãªm Ä‘Ã³.', color:'#c2185b' },
    { key:'mayor', name:'â­ Thá»‹ trÆ°á»Ÿng', hint:'Phiáº¿u biá»ƒu quyáº¿t cá»§a Thá»‹ trÆ°á»ng Ä‘Æ°á»£c tÃ­nh lÃ  2 phiáº¿u khi biá»ƒu quyáº¿t treo cá»•.', color:'#03a9f4' },
  ];

  const save = () => localStorage.setItem(STORAGE_KEY, JSON.stringify(STATE));
  const load = () => { try{ const s = JSON.parse(localStorage.getItem(STORAGE_KEY)||'null'); if(s) STATE = {...STATE, ...s}; }catch{} };
  const clamp = (n,a,b)=>Math.min(Math.max(n,a),b);
  const pad = n=>String(n).padStart(2,'0');
  const rng = (max)=>{ if(crypto?.getRandomValues){ const arr=new Uint32Array(1); crypto.getRandomValues(arr); return arr[0]/0xffffffff*max; } return Math.random()*max; };
  const shuffle = (arr)=>{ const a = arr.slice(); for(let i=a.length-1;i>0;i--){ const j=Math.floor(rng(i+1)); [a[i],a[j]]=[a[j],a[i]]; } return a; };

  // ====== NAMES UI ======
  function renderNames(){
    $.namesWrap.innerHTML = '';
    const n = Number($.playerCount.value||STATE.playerCount);
    while(STATE.names.length < n) STATE.names.push('');
    if(STATE.names.length > n) STATE.names.length = n;

    for(let i=0;i<n;i++){
      const w = document.createElement('div');
      const input = document.createElement('input');
      input.type='text'; input.placeholder = `NgÆ°á»i chÆ¡i ${i+1}`; input.value = STATE.names[i]||'';
      input.oninput = (e)=>{ STATE.names[i] = e.target.value; save(); };
      w.appendChild(input); $.namesWrap.appendChild(w);
    }
    save();
  }

  $.playerCount.addEventListener('change', ()=>{
    STATE.playerCount = clamp(Number($.playerCount.value||10),3,40);
    $.playerCount.value = STATE.playerCount;
    renderNames(); updateSlotsLeft();
  });
  $.autoFillNames.addEventListener('click', ()=>{
    const n = Number($.playerCount.value||10);
    STATE.names = Array.from({length:n},(_,i)=>`NgÆ°á»i chÆ¡i ${i+1}`);
    renderNames();
  });
  $.shuffleNames.addEventListener('click', ()=>{ STATE.names = shuffle(STATE.names); renderNames(); });

// XÃ³a cÃ¡c Ã´ tÃªn Ä‘ang trá»‘ng (chá»‰ placeholder, chÆ°a nháº­p)
$.removeEmptyNames.addEventListener('click', () => {
  const before = STATE.names.slice();
  const keep = before.filter(name => (name || '').trim() !== '');
  const removed = before.length - keep.length;

  if (removed === 0) {
    alert('KhÃ´ng cÃ³ Ã´ tÃªn trá»‘ng Ä‘á»ƒ xÃ³a.');
    return;
  }

  // Cáº­p nháº­t state + Ã´ sá»‘ ngÆ°á»i chÆ¡i
  STATE.names = keep;
  STATE.playerCount = keep.length;
  $.playerCount.value = STATE.playerCount;

  // Sau khi thay Ä‘á»•i sá»‘ ngÆ°á»i, reset khu phÃ¢n vai (trÃ¡nh lá»‡ch)
  STATE.assignments = null;
  STATE.reveal = {};
  if ($.reshuffleBtn) $.reshuffleBtn.disabled = true;
  if ($.revealAllBtn) $.revealAllBtn.disabled = true;
  if ($.copyBtn) $.copyBtn.disabled = true;
  if ($.sortBtn) $.sortBtn.disabled = true;

  renderNames();
  updateSlotsLeft();
  save();
});

  // ====== ROLES UI ======
  function ensureDefaultRoles(){ if(!STATE.roles || Object.keys(STATE.roles).length===0){ STATE.roles = {werewolf:3, seer:1, witch:1, hunter:1, guard:1, cupid:1}; } }

  function renderRoles(){
    $.rolesList.innerHTML=''; ensureDefaultRoles();

    const makeRow = (role)=>{
      const row = document.createElement('div'); row.className='item';

      const name = document.createElement('div');
      name.innerHTML = `<span class="pill" style="border-color:${role.color||'#334'}">
        <svg width="8" height="8"><circle cx="4" cy="4" r="4" fill="${role.color||'#888'}"/></svg> ${role.name}
      </span>`;

      const hint = document.createElement('div');
      const viewBtn = document.createElement('button');
      viewBtn.className='btn ghost'; viewBtn.textContent='Hiá»‡n';
      viewBtn.addEventListener('click', ()=> modal.open(role.name, role.hint||'')); hint.appendChild(viewBtn);

      const count = document.createElement('input');
      count.type='number'; count.min='0'; count.value = STATE.roles[role.key]||0;
      count.addEventListener('change', ()=>{
        STATE.roles[role.key] = clamp(Number(count.value||0),0,40);
        count.value = STATE.roles[role.key]; updateSlotsLeft(); save();
      });

      const del = document.createElement('div');

      $.rolesList.appendChild(row);
      row.append(name, hint, count, del);
    };

    DEFAULT_ROLES.forEach(makeRow);

    // Custom roles
    Object.entries(STATE.customRoles||{}).forEach(([name,countVal])=>{
      const row = document.createElement('div'); row.className='item';

      const nameDiv = document.createElement('div');
      nameDiv.innerHTML = `<span class="pill">ğŸ§© ${name}</span>`;

      const hint = document.createElement('div');
      const viewBtn2 = document.createElement('button');
      viewBtn2.className='btn ghost'; viewBtn2.textContent='Hiá»‡n';
      viewBtn2.addEventListener('click', ()=> modal.open(`ğŸ§© ${name}`, 'Vai trÃ² tÃ¹y chá»‰nh')); hint.appendChild(viewBtn2);

      const count = document.createElement('input'); count.type='number'; count.min='0'; count.value = countVal;
      count.addEventListener('change', ()=>{
        STATE.customRoles[name] = clamp(Number(count.value||0),0,40);
        if(STATE.customRoles[name]===0) delete STATE.customRoles[name];
        updateSlotsLeft(); save();
      });

      const del = document.createElement('div');
      const delBtn = document.createElement('button'); delBtn.className='btn danger'; delBtn.textContent='XoÃ¡';
      delBtn.onclick = ()=>{ delete STATE.customRoles[name]; renderRoles(); updateSlotsLeft(); save(); };
      del.appendChild(delBtn);

      $.rolesList.appendChild(row);
      row.append(nameDiv, hint, count, del);
    });

    updateSlotsLeft();
  }

  function updateSlotsLeft(){
    const totalPlayers = Number($.playerCount.value||STATE.playerCount);
    const totalSelected = totalRolesSelected();
    const left = totalPlayers - totalSelected;
    $.slotsLeft.textContent = left;
    $.slotsLeft.style.color = left < 0 ? 'salmon' : '#c7ffee';
  }

  function totalRolesSelected(){
    const base = Object.values(STATE.roles||{}).reduce((a,b)=>a+Number(b||0),0);
    const custom = Object.values(STATE.customRoles||{}).reduce((a,b)=>a+Number(b||0),0);
    return base + custom;
  }

  $.addCustomRole.addEventListener('click', ()=>{
    const name = ($.customRoleName.value||'').trim(); const count = clamp(Number($.customRoleCount.value||1),1,40);
    if(!name) return alert('Nháº­p tÃªn vai trÃ² tuá»³ chá»‰nh');
    STATE.customRoles[name] = (STATE.customRoles[name]||0) + count;
    $.customRoleName.value=''; $.customRoleCount.value='1';
    renderRoles(); save();
  });
  $.resetRoles.addEventListener('click', ()=>{ STATE.roles = {werewolf:3, seer:1, witch:1, hunter:1, guard:1, cupid:1}; STATE.customRoles = {}; renderRoles(); save(); });

  // ====== ASSIGNMENT ======
  $.assignBtn.addEventListener('click', ()=>{
    const n = Number($.playerCount.value||10);
    const names = STATE.names.slice(0,n).map((x,i)=> (x||'').trim() || `NgÆ°á»i chÆ¡i ${i+1}`);

    const parts = [];
    const addMany = (label,count)=>{ for(let i=0;i<count;i++) parts.push(label); };
    const roleNameFromKey = k => (DEFAULT_ROLES.find(r=>r.key===k)?.name) || k;

    Object.entries(STATE.roles||{}).forEach(([k,c])=> addMany(roleNameFromKey(k), Number(c||0)));
    Object.entries(STATE.customRoles||{}).forEach(([name,c])=> addMany(name, Number(c||0)));

    if(parts.length > n){ return alert(`Tá»•ng sá»‘ vai trÃ²(${parts.length}) vÆ°á»£t quÃ¡ sá»‘ ngÆ°á»i (${n}). HÃ£y giáº£m bá»›t vai trÃ² hoáº·c tÄƒng sá»‘ lÆ°á»£ng ngÆ°á»i chÆ¡i.`); }

    // ğŸ”’ CHá»T 1: láº¥p Ã´ trá»‘ng báº±ng DÃ¢n lÃ ng
  while (parts.length < n) parts.push('ğŸ‘¨ğŸ»â€ğŸŒ¾ DÃ¢n lÃ ng');

  const rolesShuffled = shuffle(parts);

  // ğŸ”’ CHá»T 2: Ä‘áº£m báº£o sau shuffle váº«n Ä‘á»§ n pháº§n tá»­
  while (rolesShuffled.length < n) rolesShuffled.push('ğŸ‘¨ğŸ»â€ğŸŒ¾ DÃ¢n lÃ ng');
    STATE.assignments = names.map((name, idx)=> ({ name, role: rolesShuffled[idx] }));
    STATE.reveal = {};
    STATE.dead = {};
    renderAssignments();
    $.reshuffleBtn.disabled = false; $.revealAllBtn.disabled=false; $.copyBtn.disabled=false; $.sortBtn.disabled=false;
    save();
  });

  $.reshuffleBtn.addEventListener('click', ()=>{
    if(!STATE.assignments) return;
    const roles = STATE.assignments.map(x=>x.role);
    const names = STATE.assignments.map(x=>x.name);
    const reshuffled = shuffle(roles);
    STATE.assignments = names.map((name,i)=>({name, role: reshuffled[i]}));
    STATE.reveal = {}; renderAssignments(); save();
  });

  $.revealAllBtn.addEventListener('click', ()=>{
    const anyHidden = Object.values(STATE.reveal||{}).some(v=>!v);
    STATE.assignments.forEach((_,i)=> STATE.reveal[i] = anyHidden );
    renderAssignments(); save();
  });

  $.copyBtn.addEventListener('click', async ()=>{
    if(!STATE.assignments) return;
    const lines = STATE.assignments.map((x,i)=> `${i+1}. ${x.name} â€” ${x.role}`).join('\n');
    try{ await navigator.clipboard.writeText(lines); alert('ÄÃ£ sao chÃ©p danh sÃ¡ch vai trÃ² vÃ o clipboard!'); }
    catch{ alert('KhÃ´ng thá»ƒ sao chÃ©p, hÃ£y chá»n thá»§ cÃ´ng.'); }
  });

  // ====== SORT & HIGHLIGHT ======
  function _ascii(s){
    return String(s).toLowerCase()
      .normalize('NFD').replace(/[\u0300-\u036f]/g,'');
  }
  function _roleKey(role){
    return String(role).replace(/^[^\p{L}\p{N}]+/u,'').trim().toLowerCase();
  }
  function factionOf(role){
    const t = _ascii(role);
    // Phe SÃ³i
    if (t.includes('soi con') || t.includes('ke phan boi') || t.includes('soi'))
      return {order:0, cls:'f-wolf'};
    // Phe DÃ¢n
    if (t.includes('than tinh yeu')||t.includes('tien tri')||t.includes('phu thuy')||
        t.includes('tho san')||t.includes('bao ve')||t.includes('phap su cam')||
        t.includes('dan lang')||t.includes('hoang tu')||t.includes('gia lang')||
        t.includes('luc si')||t.includes('thi truong'))
      return {order:1, cls:'f-vil'};
    // Phe Ä‘á»•i phe
    if (t.includes('nhan ban')||t.includes('ke bi nguyen'))
      return {order:2, cls:'f-swap'};
    // Phe thá»© ba / khÃ¡c
    if (t.includes('chan doi'))
      return {order:3, cls:'f-third'};
    return {order:3, cls:'f-third'};
  }

  function sortAssignmentsByFactionThenRole(){
  if (!STATE.assignments || STATE.assignments.length === 0) return;

  // Giá»¯ tráº¡ng thÃ¡i "Ä‘Ã£ hiá»‡n" theo TÃŠN trÆ°á»›c khi sáº¯p xáº¿p
  const revealByName = {};
  STATE.assignments.forEach((x, i) => {
    revealByName[x.name] = !!STATE.reveal[i];
  });

  // Map Ä‘Ã¡nh dáº¥u cháº¿t theo tÃªn (Ä‘Ã£ set á»Ÿ STATE.dead)
  const deadByName = { ...(STATE.dead || {}) };

  STATE.assignments.sort((a, b) => {
    // 1) Alive trÆ°á»›c, Dead sau
    const aDead = !!deadByName[a.name];
    const bDead = !!deadByName[b.name];
    if (aDead !== bDead) return aDead ? 1 : -1;

    // 2) Sáº¯p theo phe
    const fa = factionOf(a.role);
    const fb = factionOf(b.role);
    if (fa.order !== fb.order) return fa.order - fb.order;

    // 3) CÃ¹ng phe thÃ¬ sáº¯p theo alphabet cá»§a tÃªn vai trÃ²
    const ra = _roleKey(a.role);
    const rb = _roleKey(b.role);
    return ra.localeCompare(rb, 'vi');
  });

  // KhÃ´i phá»¥c tráº¡ng thÃ¡i "Ä‘Ã£ hiá»‡n" theo vá»‹ trÃ­ má»›i
  STATE.reveal = {};
  STATE.assignments.forEach((x, i) => {
    STATE.reveal[i] = !!revealByName[x.name];
  });

  renderAssignments();
  save();
}

function toggleDeadByName(name){
  STATE.dead = STATE.dead || {};
  STATE.dead[name] = !STATE.dead[name];
  renderAssignments(); save();
}

  function renderAssignments(){
  if(!STATE.assignments){ $.assignments.innerHTML=''; return; }

  const rows = STATE.assignments.map((x,i)=>{
    const revealed = !!STATE.reveal[i];
    const fac = factionOf(x.role);
    const isDead = !!(STATE.dead && STATE.dead[x.name]);
    const safeNameAttr = String(x.name).replace(/"/g,'&quot;'); // attr-safe
    const roleCell = revealed ? escapeHtml(x.role) : '&nbsp;';   // trá»‘ng khi áº¨n

    return `<tr class="${revealed? 'revealed':''} ${fac.cls} ${isDead?'dead':''}"
               data-name="${safeNameAttr}">
      <td>${i+1}</td>
      <td class="name-cell">
  <div class="name-wrap">
    <span class="player-name">${escapeHtml(x.name)}</span>
    ${isDead ? '<span class="eliminated">â€“ Bá»Š LOáº I</span>' : ''}
  </div>
</td>
      <td class="role ${revealed? '':'hidden'}">${roleCell}</td>
      <td class="no-print">
  <button class="btn ${isDead ? '' : 'danger'}" data-kill="${i}">
    ${isDead ? 'Cá»©u' : 'Giáº¿t'}
  </button>
</td>

    </tr>`;
  }).join('');

  $.assignments.innerHTML = `
  <div class="section-title">
    <h2>ğŸ“ƒ Danh sÃ¡ch phÃ¢n vai trÃ²</h2>
    <div class="chip">Tá»•ng: <b>${STATE.assignments.length}</b></div>
  </div>
  <div class="table-wrap">
    <table aria-label="Danh sÃ¡ch phÃ¢n vai trÃ²">
      <thead>
        <tr><th>#</th><th>TÃªn ngÆ°á»i chÆ¡i</th><th>Vai trÃ²</th>
        <th class="no-print">Giáº¿t</th></tr>
      </thead>
      <tbody>${rows}</tbody>
    </table>
  </div>`;

  // Báº¥m nÃºt Giáº¿t/Há»“i sinh (toggle "Ä‘Ã£ cháº¿t")
qsa('[data-kill]', $.assignments).forEach(btn => {
  btn.addEventListener('click', (e) => {
    const i = Number(e.currentTarget.getAttribute('data-kill'));
    const name = STATE.assignments[i]?.name;
    if (!name) return;
    toggleDeadByName(name);     // Ä‘Ã£ cÃ³ sáºµn trong mÃ£
  });
});

  // double-click / double-tap Ä‘á»ƒ toggle â€œÄ‘Ã£ cháº¿tâ€
  qsa('tbody tr', $.assignments).forEach(tr=>{
    const name = tr.getAttribute('data-name'); // DOM sáº½ decode &quot; => "
    // cháº·n khi click vÃ o nÃºt
    tr.addEventListener('dblclick', (e)=>{
      if (e.target.closest('button')) return;
      toggleDeadByName(name);
    });
    // mobile: double-tap trong ~300ms
    let lastTap = 0;
    tr.addEventListener('touchend', (e)=>{
      if (e.target.closest('button')) return;
      const now = Date.now();
      if (now - lastTap < 300){ toggleDeadByName(name); e.preventDefault(); }
      lastTap = now;
    }, {passive:false});
  });
}

  $.sortBtn.addEventListener('click', sortAssignmentsByFactionThenRole);

  function escapeHtml(str){ return String(str).replace(/[&<>"']/g, s=>({"&":"&amp;","<":"&lt;",">":"&gt;","\"":"&quot;","'":"&#39;"}[s])); }

  // ====== TIMER ======
  let TICK = null; let remaining = 120; let countingUp=false;

  function setTimerFromInputs(){
    const min = clamp(Number($.timerMin.value||0),0,999);
    const sec = clamp(Number($.timerSec.value||0),0,59);
    $.timerMin.value=min; $.timerSec.value=sec;
    if($.timerMode.value==='down'){ remaining = min*60 + sec; countingUp=false; }
    else { remaining = 0; countingUp=true; }
    updateTimerDisplay();
    STATE.timer = { ...STATE.timer, mode: $.timerMode.value, min, sec, left: remaining, running:false, sound: $.soundToggle.checked };
    $.startPauseBtn.textContent='â–¶ï¸ Báº¯t Ä‘áº§u'; save();
  }

  function updateTimerDisplay(){
    const sec = Math.max(0, Math.floor(remaining%60));
    const min = Math.max(0, Math.floor(remaining/60));
    $.timerDisplay.textContent = `${pad(min)}:${pad(sec)}`;
  }

  // Thay toÃ n bá»™ hÃ m beep() cÅ© báº±ng hÃ m má»›i nÃ y
  function beep(times = 5, vol = 1.0, freq = 900, dur = 180, gap = 120){
    if(!$.soundToggle.checked) return;

    // RUNG: 5 nhá»‹p 200ms, nghá»‰ 100ms
    try{ navigator.vibrate && navigator.vibrate([200,100,200,100,200,100,200,100,200]); }catch{}

    // Ã‚M THANH: nhiá»u "tÃºt" liá»n nhau
    try{
      const AudioCtx = window.AudioContext || window.webkitAudioContext;
      const ctx = new AudioCtx();

      let t = ctx.currentTime;
      for(let i = 0; i < times; i++){
        const o = ctx.createOscillator();
        const g = ctx.createGain();
        o.connect(g); g.connect(ctx.destination);

        // Giá»¯ tiáº¿ng "tÃºt" rÃµ rÃ ng
        o.type = 'sine';
        o.frequency.setValueAtTime(freq, t);

        // Envelope Ä‘á»ƒ nghe to nhÆ°ng khÃ´ng rÃ¨
        g.gain.setValueAtTime(0.0001, t);
        g.gain.exponentialRampToValueAtTime(vol, t + 0.02);           // lÃªn nhanh
        g.gain.exponentialRampToValueAtTime(0.0001, t + dur/1000);    // táº¯t nhanh

        o.start(t);
        o.stop(t + dur/1000 + 0.01);

        // khoáº£ng nghá»‰ giá»¯a cÃ¡c "tÃºt"
        t += (dur + gap) / 1000;
      }

      // Ä‘Ã³ng context sau khi phÃ¡t xong Ä‘á»ƒ tiáº¿t kiá»‡m pin
      const total = times*dur + (times-1)*gap + 200;
      setTimeout(()=>{ try{ ctx.close(); }catch{} }, total);
    }catch{}
  }

  function startPause(){
    if(TICK){ clearInterval(TICK); TICK=null; $.startPauseBtn.textContent='â–¶ï¸ Tiáº¿p tá»¥c'; STATE.timer.running=false; save(); return; }
    $.startPauseBtn.textContent='âšâš Táº¡m dá»«ng'; STATE.timer.running=true; save();
    TICK = setInterval(()=>{
      remaining += countingUp ? 1 : -1;
      updateTimerDisplay();
      if(!countingUp && remaining<=0){ clearInterval(TICK); TICK=null; beep(); $.startPauseBtn.textContent='â–¶ï¸ Báº¯t Ä‘áº§u'; STATE.timer.running=false; save(); }
    }, 1000);
  }

  function resetTimer(){ clearInterval(TICK); TICK=null; setTimerFromInputs(); }

  $.timerMode.addEventListener('change', setTimerFromInputs);
  $.timerMin.addEventListener('change', setTimerFromInputs);
  $.timerSec.addEventListener('change', setTimerFromInputs);
  $.startPauseBtn.addEventListener('click', startPause);
  $.resetTimerBtn.addEventListener('click', resetTimer);
  qsa('[data-preset]').forEach(btn=> btn.addEventListener('click', (e)=>{
    const s = Number(e.currentTarget.getAttribute('data-preset'))||120;
    $.timerMode.value='down'; $.timerMin.value = Math.floor(s/60); $.timerSec.value = s%60; setTimerFromInputs();
  }));
  $.soundToggle.addEventListener('change', ()=>{ STATE.timer.sound = $.soundToggle.checked; save(); });

  // ====== NOTES ======
  const notesEl = qs('#notes');

// Tá»± giÃ£n chiá»u cao ghi chÃº theo ná»™i dung
function autoGrowNotes(){
  if(!notesEl) return;
  notesEl.style.height = 'auto';                    // reset
  notesEl.style.height = Math.max(160, notesEl.scrollHeight) + 'px';
}

// khi nháº­p thÃ¬ tá»± giÃ£n
notesEl.addEventListener('input', autoGrowNotes);
// náº¿u cá»­a sá»• Ä‘á»•i kÃ­ch thÆ°á»›c (mobile xoayâ€¦), tÃ­nh láº¡i
window.addEventListener('resize', autoGrowNotes);

  notesEl.addEventListener('input', ()=>{ STATE.notes = notesEl.value; save(); });

  // NÃºt: XÃ³a táº¥t cáº£
  $.clearNotesBtn.addEventListener('click', ()=>{
    notesEl.value = '';
    STATE.notes = '';
    save();
    autoGrowNotes();
    notesEl.focus();
  });

  // NÃºt: Soáº¡n máº«u nhanh
  $.quickTemplateBtn.addEventListener('click', ()=>{
    const tpl =
`ğŸº SÃ³i _________ Giáº¿t:
ğŸ›¡ï¸ Báº£o vá»‡ ______ Cháº¯n:
ğŸ§™â€â™‚ï¸ PhÃ¹ Thá»§y _____ Cá»©u:
ğŸ§™â€â™‚ï¸ PhÃ¹ Thá»§y ____ Giáº¿t:
ğŸ¹ Thá»£ sÄƒn _____ Ngáº¯m:
ğŸ’˜ Cupid _______ GhÃ©p:
ğŸ‘¥ NhÃ¢n báº£n ____ Chá»n:
ğŸ”‡ PhÃ¡p sÆ° cÃ¢m __ CÃ¢m: `;
    notesEl.value = tpl;
    STATE.notes = tpl;
    save();
    autoGrowNotes();
    // ÄÆ°a con trá» vá» cuá»‘i cho tiá»‡n ghi tiáº¿p
    notesEl.focus();
    try{
      notesEl.selectionStart = notesEl.selectionEnd = notesEl.value.length;
    }catch{}
  });

  // ====== INIT ======
  function init(){
    load();
    $.playerCount.value = STATE.playerCount;
    renderNames();

    ensureDefaultRoles();
    renderRoles();

    if(STATE.assignments){ renderAssignments(); $.reshuffleBtn.disabled=false; $.revealAllBtn.disabled=false; $.copyBtn.disabled=false; $.sortBtn.disabled=false; }

    notesEl.value = STATE.notes||'';
    autoGrowNotes();

    $.timerMode.value = STATE.timer.mode||'down';
    $.timerMin.value = STATE.timer.min||0; $.timerSec.value = STATE.timer.sec||0;
    let remainingLocal = STATE.timer.left || (STATE.timer.mode==='down' ? (STATE.timer.min*60 + STATE.timer.sec): 0);
    remaining = remainingLocal;
    countingUp = STATE.timer.mode==='up'; $.soundToggle.checked = !!STATE.timer.sound;
    updateTimerDisplay();
    if(STATE.timer.running){ startPause(); }

    updateSlotsLeft();
  }

  init();
})();
</script>
</body>
</html>